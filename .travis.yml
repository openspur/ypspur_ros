sudo: required
services: docker

cache:
  directories:
    - /home/travis/docker/
env:
  global:
    - PACKAGE_NAME=ypspur_ros
    - DOCKER_CACHE_FILE=/home/travis/docker/cache.tar.lz4
    - DOCKER_CACHE_TARGETS="${PACKAGE_NAME}:latest ${PACKAGE_NAME}:indigo"
branches:
  only:
    - master

before_install:
  - .travis.scripts/setup_docker.sh
  - .travis.scripts/load_cache.sh

install: true

script:
  - docker build -t ${PACKAGE_NAME}:latest --pull=true ${TRAVIS_BUILD_DIR} --build-arg TRAVIS_PULL_REQUEST=${TRAVIS_PULL_REQUEST} --build-arg TRAVIS_REPO_SLUG=${TRAVIS_REPO_SLUG} --build-arg TRAVIS_BOT_GITHUB_TOKEN=${TRAVIS_BOT_GITHUB_TOKEN} --build-arg PACKAGE_NAME=${PACKAGE_NAME}
  - docker build -t ${PACKAGE_NAME}:indigo -f Dockerfile.indigo --pull=true ${TRAVIS_BUILD_DIR} --build-arg TRAVIS_PULL_REQUEST=${TRAVIS_PULL_REQUEST} --build-arg TRAVIS_REPO_SLUG=${TRAVIS_REPO_SLUG} --build-arg TRAVIS_BOT_GITHUB_TOKEN=${TRAVIS_BOT_GITHUB_TOKEN} --build-arg PACKAGE_NAME=${PACKAGE_NAME}
  - .travis.scripts/save_cache.sh

